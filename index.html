
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D íë¸Œ ì½”ì¸ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Tailwind CSS ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js (3D ë¼ì´ë¸ŒëŸ¬ë¦¬) ë¡œë“œ --><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Chart.js (ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬) ë¡œë“œ --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 'Inter' í°íŠ¸ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš© */
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* ì „ì²´ í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        /* 3D ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ (renderer.domElement) */
        canvas { display: block; }
        
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .history-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #93c5fd; border-radius: 20px; }
        .history-scrollbar::-webkit-scrollbar-thumb { background-color: #93c5fd; border-radius: 20px; }

        /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-disabled { background-color: #4b5563 !important; cursor: not-allowed; opacity: 0.7; }
        
        /* íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ (v2) */
        .tab-active { border-bottom-color: #60a5fa !important; color: #60a5fa !important; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- 
    ==========================================
    ë¡œê·¸ì¸ ì»¨í…Œì´ë„ˆ
    ==========================================
    -->
    <div id="login-container" class="fixed inset-0 bg-gray-900 flex justify-center items-center z-50">
        <div class="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-lg shadow-lg">
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <div id="login-form">
                <h2 class="text-2xl font-bold text-center text-white">ë¡œê·¸ì¸</h2>
                <div class="mt-4 space-y-4">
                    <input type="email" id="login-email" class="w-full bg-gray-700 text-white p-3 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì´ë©”ì¼">
                    <input type="password" id="login-password" class="w-full bg-gray-700 text-white p-3 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ë¹„ë°€ë²ˆí˜¸">
                    <button id="login-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-lg transition-colors">ë¡œê·¸ì¸</button>
                </div>
                <p class="mt-4 text-center text-sm text-gray-400">
                    ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="#" id="show-signup-form" class="font-medium text-blue-400 hover:underline">íšŒì›ê°€ì…</a>
                </p>
            </div>

            <!-- íšŒì›ê°€ì… í¼ (ê¸°ë³¸ ìˆ¨ê¹€) -->
            <div id="signup-form" class="hidden">
                <h2 class="text-2xl font-bold text-center text-white">íšŒì›ê°€ì…</h2>
                <div class="mt-4 space-y-4">
                    <input type="email" id="signup-email" class="w-full bg-gray-700 text-white p-3 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì´ë©”ì¼">
                    <input type="password" id="signup-password" class="w-full bg-gray-700 text-white p-3 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
                    <input type="password" id="signup-password-confirm" class="w-full bg-gray-700 text-white p-3 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
                    <button id="signup-button" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold p-3 rounded-lg transition-colors">íšŒì›ê°€ì…</button>
                </div>
                <p class="mt-4 text-center text-sm text-gray-400">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="#" id="show-login-form" class="font-medium text-blue-400 hover:underline">ë¡œê·¸ì¸</a>
                </p>
            </div>
            
            <p id="login-error-message" class="text-center text-sm text-red-400 h-4"></p>
        </div>
    </div>
    
    <!-- ì—…ë°ì´íŠ¸ ì•ˆë‚´ ë°°ë„ˆ -->
    <div id="update-banner" class="hidden fixed top-0 left-0 w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white text-center p-2 z-50 shadow-lg text-sm font-bold">
        v.0.3.0 ë‹¬ë¹› ì—…ë°ì´íŠ¸ê°€ ê³§ ì‹œì‘ë©ë‹ˆë‹¤!
    </div>

    <!-- 
    ==========================================
    v2 (ì‹  ë²„ì „) ê²Œì„ ì»¨í…Œì´ë„ˆ
    ==========================================
    -->
    <div id="v2-container" class="hidden">
        <div class="flex flex-col lg:flex-row w-full h-screen">
            <!-- ì™¼ìª½: 3D ë·°ì–´ --><div id="v2-canvas-container" class="lg:w-1/2 w-full h-1/2 lg:h-full relative bg-black transition-all duration-300">
                <div class="absolute top-4 left-4 bg-black/50 backdrop-blur-sm p-4 rounded-lg shadow-xl z-20">
                    <div><h2 class="text-sm font-semibold text-blue-300 uppercase">CUBE-KRW</h2><div id="v2-current-price" class="text-3xl font-bold text-white">10,000 KRW</div><div id="v2-price-change" class="text-lg font-medium text-gray-300">-</div></div>
                    <div class="mt-4"><h2 class="text-sm font-semibold text-pink-300 uppercase">PRISM-KRW</h2><div id="v2-current-prism-price" class="text-3xl font-bold text-white">50,000 KRW</div><div id="v2-prism-price-change" class="text-lg font-medium text-gray-300">-</div></div>
                    <div id="v2-lunar-price-display" class="mt-4 hidden"><h2 class="text-sm font-semibold text-yellow-300 uppercase">LUNAR-KRW</h2><div id="v2-current-lunar-price" class="text-3xl font-bold text-white">20,000 KRW</div><div id="v2-lunar-price-change" class="text-lg font-medium text-gray-300">-</div></div>
                    <div id="v2-time-container" class="mt-4 hidden"><h2 class="text-sm font-semibold text-gray-300 uppercase">GAME TIME</h2><div id="v2-game-time" class="text-xl font-bold text-white">09:00 (Day)</div></div>
                </div>
                <div class="absolute bottom-4 left-4 flex flex-col md:flex-row gap-4 items-start md:items-end z-20">
                    <div id="v2-passive-income-display" class="bg-black/50 backdrop-blur-sm p-3 rounded-lg shadow-xl hidden"><h3 class="text-sm font-semibold text-green-300">íŒ¨ì‹œë¸Œ ìˆ˜ì…</h3><div id="v2-income-per-second" class="text-lg font-bold text-white">+0 KRW / sec</div></div>
                    <div id="v2-upgrade-prism-section" class="bg-black/50 backdrop-blur-sm p-4 rounded-lg shadow-xl text-center hidden"><h3 class="text-lg font-bold mb-2 text-pink-300">í”„ë¦¬ì¦˜ ì—…ê·¸ë ˆì´ë“œ</h3><p class="text-gray-300 text-sm mb-3">íë¸Œë¥¼ í”„ë¦¬ì¦˜ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ<br>(í•„ìš”: 100 PRISM)</p><button id="v2-upgrade-prism-button" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg">100 PRISMì— ì—…ê·¸ë ˆì´ë“œ</button></div>
                    <div id="v2-upgrade-lunar-section" class="bg-black/50 backdrop-blur-sm p-4 rounded-lg shadow-xl text-center hidden"><h3 class="text-lg font-bold mb-2 text-yellow-300">ë‹¬ë¹› ê°•í™”</h3><p class="text-gray-300 text-sm mb-3">íë¸Œì— ë‹¬ì˜ í˜ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.</p><button id="v2-upgrade-lunar-blessing-button" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg">Lunar Blessing (200 LUNAR)</button></div>
                </div>
                <div id="v2-cube-purchase-overlay" class="absolute inset-0 bg-black/70 backdrop-blur-sm flex flex-col justify-center items-center text-center p-4 z-10"><div id="v2-buy-cube-section"><h3 class="text-2xl font-bold mb-2">3D íë¸Œ ì ê¸ˆ í•´ì œ</h3><p class="text-gray-300 mb-4">íë¸Œë¥¼ í™œì„±í™”í•˜ê³  ì´ˆë‹¹ 100 KRWë¥¼ ìƒì‚°í•˜ë ¤ë©´ 1,000,000 KRWê°€ í•„ìš”í•©ë‹ˆë‹¤.</p><button id="v2-buy-cube-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">1,000,000 KRWì— êµ¬ë§¤</button></div></div>
            </div>
            <!-- ì˜¤ë¥¸ìª½: ëŒ€ì‹œë³´ë“œ --><div id="v2-dashboard" class="lg:w-1/2 w-full h-1/2 lg:h-full p-6 bg-gray-800 flex flex-col gap-4 overflow-y-auto custom-scrollbar transition-all duration-300">
                <h1 id="v2-game-title" class="text-3xl font-bold text-center text-white mb-2">íë¸Œ ì½”ì¸ ì‹œë®¬ë ˆì´í„° v.0.2.2</h1>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-assets"><h3 class="text-lg font-semibold text-white">ë‚´ ìì‚° í˜„í™©</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-assets-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-assets" class="px-4 pb-4"><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div class="bg-gray-600 p-4 rounded-lg"><h3 class="text-sm font-semibold text-gray-300">í˜„ê¸ˆ (KRW)</h3><div id="v2-user-cash" class="text-2xl font-bold text-blue-400">100,000</div></div><div class="bg-gray-600 p-4 rounded-lg"><h3 class="text-sm font-semibold text-gray-300">íë¸Œ (CUBE)</h3><div id="v2-user-cubes" class="text-2xl font-bold text-purple-400">0</div></div><div class="bg-gray-600 p-4 rounded-lg"><h3 class="text-sm font-semibold text-gray-300">í”„ë¦¬ì¦˜ (PRISM)</h3><div id="v2-user-prisms" class="text-2xl font-bold text-pink-400">0</div></div><div id="v2-lunar-asset-display" class="bg-gray-600 p-4 rounded-lg hidden"><h3 class="text-sm font-semibold text-gray-300">ë£¨ë‚˜ (LUNAR)</h3><div id="v2-user-lunar" class="text-2xl font-bold text-yellow-400">0</div></div></div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-trade"><h3 class="text-lg font-semibold text-white">ë§¤ìˆ˜ / ë§¤ë„</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-trade-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-trade" class="px-4 pb-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-gray-600 p-4 rounded-lg"><label class="text-lg font-semibold text-blue-300">CUBE ê±°ë˜</label><input type="number" id="v2-amount-input-cube" value="1" min="1" class="w-full bg-gray-800 text-white p-2 rounded mt-2 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="CUBE ìˆ˜ëŸ‰"><div class="grid grid-cols-2 gap-4 mt-4"><button id="v2-buy-button-cube" class="w-full bg-green-600 hover:bg-green-700 font-bold p-3 rounded-lg">ë§¤ìˆ˜</button><button id="v2-sell-button-cube" class="w-full bg-red-600 hover:bg-red-700 font-bold p-3 rounded-lg">ë§¤ë„</button></div></div><div class="bg-gray-600 p-4 rounded-lg"><label class="text-lg font-semibold text-pink-300">PRISM ê±°ë˜</label><input type="number" id="v2-amount-input-prism" value="1" min="1" class="w-full bg-gray-800 text-white p-2 rounded mt-2 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="PRISM ìˆ˜ëŸ‰"><div class="grid grid-cols-2 gap-4 mt-4"><button id="v2-buy-button-prism" class="w-full bg-green-600 hover:bg-green-700 font-bold p-3 rounded-lg">ë§¤ìˆ˜</button><button id="v2-sell-button-prism" class="w-full bg-red-600 hover:bg-red-700 font-bold p-3 rounded-lg">ë§¤ë„</button></div></div><div id="v2-lunar-trade-section" class="bg-gray-600 p-4 rounded-lg md:col-span-2 hidden"><label class="text-lg font-semibold text-yellow-300">LUNAR ê±°ë˜</label><input type="number" id="v2-amount-input-lunar" value="1" min="1" class="w-full bg-gray-800 text-white p-2 rounded mt-2 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="LUNAR ìˆ˜ëŸ‰"><div class="grid grid-cols-2 gap-4 mt-4"><button id="v2-buy-button-lunar" class="w-full bg-green-600 hover:bg-green-700 font-bold p-3 rounded-lg">ë§¤ìˆ˜</button><button id="v2-sell-button-lunar" class="w-full bg-red-600 hover:bg-red-700 font-bold p-3 rounded-lg">ë§¤ë„</button></div></div></div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-charts"><h3 class="text-lg font-semibold text-white">ì‹¤ì‹œê°„ ì°¨íŠ¸</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-charts-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-charts" class="px-4 pb-4"><nav class="flex border-b border-gray-600 mb-4"><button id="v2-chart-tab-cube" class="py-2 px-4 border-b-2 border-transparent text-gray-400 hover:text-white tab-active">CUBE</button><button id="v2-chart-tab-prism" class="py-2 px-4 border-b-2 border-transparent text-gray-400 hover:text-white">PRISM</button><button id="v2-chart-tab-lunar" class="py-2 px-4 border-b-2 border-transparent text-gray-400 hover:text-white hidden">LUNAR</button></nav><div id="v2-chart-cube-container" class="h-40"><canvas id="v2-price-chart"></canvas></div><div id="v2-chart-prism-container" class="h-40 hidden"><canvas id="v2-prism-price-chart"></canvas></div><div id="v2-chart-lunar-container" class="h-40 hidden"><canvas id="v2-lunar-price-chart"></canvas></div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-history"><h3 class="text-lg font-semibold text-white">ê±°ë˜ ë‚´ì—­</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-history-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-history" class="px-4 pb-4"><div id="v2-transaction-history" class="h-32 overflow-y-auto custom-scrollbar pr-2 bg-gray-600 rounded-lg p-2">...</div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-news"><h3 class="text-lg font-semibold text-white">ì‹¤ì‹œê°„ ë‰´ìŠ¤ (ì˜ˆì¸¡)</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-news-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-news" class="px-4 pb-4"><div id="v2-news-feed" class="h-24 overflow-y-auto custom-scrollbar pr-2 bg-gray-600 rounded-lg p-2">...</div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-jobs"><h3 class="text-lg font-semibold text-white">ë‹¤ì–‘í•œ ëˆë²Œì´</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-jobs-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-jobs" class="px-4 pb-4"><div class="grid grid-cols-1 gap-4"><button id="v2-job-paper" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold p-3 rounded-lg"><span id="v2-job-paper-text">íì§€ ì¤ê¸° (+500)</span><span id="v2-job-paper-timer" class="text-sm ml-2"></span></button><button id="v2-job-starcatching" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold p-3 rounded-lg hidden">ë°¤í•˜ëŠ˜ì— ë³„ ë”°ê¸°<span id="v2-job-starcatching-timer" class="text-sm ml-2"></span></button></div></div></div>
                <div id="v2-sleep-section" class="bg-gray-700 rounded-lg shadow-lg hidden"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-sleep"><h3 class="text-lg font-semibold text-white">ìˆ˜ë©´</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-sleep-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-sleep" class="px-4 pb-4 hidden"><div class="flex items-center gap-4"><p class="text-gray-300 text-sm flex-grow">ë°¤ì— ì ì„ ìì„œ ì•„ì¹¨ 8ì‹œê¹Œì§€ ì‹œê°„ì„ ê±´ë„ˆëœë‹ˆë‹¤.</p><button id="v2-sleep-button" class="bg-blue-600 hover:bg-blue-700 font-bold py-2 px-6 rounded-lg btn-disabled">ìˆ˜ë©´</button></div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg">
                    <div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-trophies">
                        <h3 class="text-lg font-semibold text-white">ì´ë²¤íŠ¸ íŠ¸ë¡œí”¼</h3>
                        <svg class="w-5 h-5 text-gray-400" id="v2-toggle-trophies-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div id="v2-content-trophies" class="px-4 pb-4 hidden">
                        <div id="v2-trophy-list" class="space-y-3 mb-4">
                            <!-- JS will populate this -->
                        </div>
                        <div class="border-t border-gray-600 pt-3">
                            <h4 class="text-md font-semibold text-blue-300 mb-2">ì´ íš¨ê³¼</h4>
                            <div id="v2-trophy-effects" class="text-sm text-gray-300">
                                <!-- JS will populate this -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-code"><h3 class="text-lg font-semibold text-white">ì½”ë“œ ì…ë ¥</h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-code-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-code" class="px-4 pb-4"><div class="flex gap-4"><input type="text" id="v2-code-input" class="w-full bg-gray-800 text-white p-2 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì½”ë“œ ì…ë ¥"><button id="v2-code-submit-button" class="bg-purple-600 hover:bg-purple-700 font-bold py-2 px-6 rounded-lg">ì…ë ¥</button></div></div></div>
                <div class="bg-gray-700 rounded-lg shadow-lg"><div class="flex justify-between items-center p-4 cursor-pointer" id="v2-toggle-updates"><h3 class="text-lg font-semibold text-white">ì—…ë°ì´íŠ¸ ë‚´ì—­ <span id="v2-version-display">(v.0.2.2)</span></h3><svg class="w-5 h-5 text-gray-400" id="v2-toggle-updates-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div><div id="v2-content-updates" class="px-4 pb-4 hidden"><ul id="v2-update-list" class="list-disc list-inside text-gray-300 text-sm space-y-1"><li>ì½˜ì†” ì˜¤ë¥˜ ìˆ˜ì • ë° Firebase ë¡œì§ ì•ˆì •í™”</li><li>ì½”ë“œ ì…ë ¥ 1íšŒ ì œí•œ</li><li>í”„ë¦¬ì¦˜ ì—…ê·¸ë ˆì´ë“œ UI ìœ„ì¹˜ ë³€ê²½</li><li>'ë²½ëŒ ìš´ë°˜' ê¸°ëŠ¥ ì œê±°</li><li>'íì§€ ì¤ê¸°' ë°œì „ê³¼ì œ ì‹œìŠ¤í…œ ì¶”ê°€</li><li>v.0.2.2 ì—…ë°ì´íŠ¸ ë‚´ì—­ ì¶”ê°€</li></ul></div></div>
                <!-- ë¡œê·¸ì•„ì›ƒ --><div id="v2-logout-section" class="bg-gray-700 p-4 rounded-lg shadow-lg"><h3 class="text-lg font-semibold mb-2 text-white">ê³„ì •</h3><button id="v2-logout-button" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors shadow-lg">ë¡œê·¸ì•„ì›ƒ</button></div>
            </div>
        </div>
        <div id="v2-notification" class="fixed bottom-6 right-6 bg-red-500 text-white p-4 rounded-lg shadow-xl transition-all duration-300 opacity-0 translate-y-10 z-50"></div>
    </div>

    <!-- 
    ==========================================
    ê³µí†µ JavaScript
    ==========================================
    -->
    <script>
        // --- ì „ì—­ ì„¤ì • ---
        const UPDATES = [
            { 
                version: 'v.0.3.0', 
                time: new Date('2025-11-15T18:00:00+09:00').getTime(), 
                code: 'LUNAR',
                codeWindowHours: 1
            },
            // Future updates can be added here
        ];
        const TROPHIES = {
            twilight: {
                name: 'Twilight Trophy',
                description: 'ë°¤í•˜ëŠ˜ì—ì„œ ë°˜ì§ì´ëŠ” ë³„ì„ ì†ì— ë„£ì€ ìì—ê²Œ ì£¼ì–´ì§€ëŠ” ì¦í‘œ.',
                isUnlocked: () => v2_hasTwilightTrophy,
                effectText: 'ë°¤ ì‹œê°„ ë™ì•ˆ ëª¨ë“  ì½”ì¸ ê°€ê²© ìƒìŠ¹ í™•ë¥  +2.5%',
            }
        };
        let isV3Active = false;
        let isPreviewMode = false;
        let db, auth, userId;
        let v2_gameLoopTimeout = null, v2_priceUpdateTimeout = null;
        let v2_zeroCooldownEndTime = 0;
        let v2_starCatchingBuffEndTime = 0;
        
        // =======================================================
        // V2 ê²Œì„ ë¡œì§
        // =======================================================
        let v2_userCash = 100000, v2_userCubes = 0, v2_userPrisms = 0, v2_currentPrice = 10000, v2_lastPrice = 10000, v2_currentPrismPrice = 50000, v2_lastPrismPrice = 50000, v2_transactions = [], v2_isCubePurchased = false, v2_isPrismUpgraded = false, v2_usedCodes = [], v2_paperClicks = 0; let v2_dom = {}; let v2_scene, v2_camera, v2_renderer, v2_cube, v2_cubeMaterial, v2_ambientLight, v2_directionalLight; let v2_jobTimers = { paper: 0, starcatching: 0 }; let v2_priceChart, v2_prismPriceChart, v2_lunarPriceChart;
        // v0.3.0 state
        let v2_userLunar = 0, v2_currentLunarPrice = 20000, v2_lastLunarPrice = 20000, v2_hasTwilightTrophy = false, v2_isLunarBlessed = false, v2_gameTime, v2_isDay = true;

        function initV2Charts() { const commonOptions = { scales: { y: { ticks: { color: '#9ca3af' }, grid: { color: '#4b5563' } }, x: { ticks: { color: '#9ca3af' }, grid: { color: '#4b5563' } } }, plugins: { legend: { display: false } }, maintainAspectRatio: false }; if (document.getElementById('v2-price-chart')) { const ctxCube = document.getElementById('v2-price-chart').getContext('2d'); v2_priceChart = new Chart(ctxCube, { type: 'line', data: { labels: [], datasets: [{ label: 'CUBE Price', data: [], borderColor: '#60a5fa', tension: 0.1, pointRadius: 0 }] }, options: commonOptions }); } if (document.getElementById('v2-prism-price-chart')) { const ctxPrism = document.getElementById('v2-prism-price-chart').getContext('2d'); v2_prismPriceChart = new Chart(ctxPrism, { type: 'line', data: { labels: [], datasets: [{ label: 'PRISM Price', data: [], borderColor: '#f472b6', tension: 0.1, pointRadius: 0 }] }, options: commonOptions }); } if (isV3Active && document.getElementById('v2-lunar-price-chart')) { const ctxLunar = document.getElementById('v2-lunar-price-chart').getContext('2d'); v2_lunarPriceChart = new Chart(ctxLunar, { type: 'line', data: { labels: [], datasets: [{ label: 'LUNAR Price', data: [], borderColor: '#facc15', tension: 0.1, pointRadius: 0 }] }, options: commonOptions }); } }
        function v2_updateChartData(chart, price) { if (!chart) return; const now = isV3Active ? v2_gameTime : new Date(); const label = isV3Active ? `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}` : `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`; chart.data.labels.push(label); chart.data.datasets[0].data.push(price); const maxDataPoints = 30; if (chart.data.labels.length > maxDataPoints) { chart.data.labels.shift(); chart.data.datasets[0].data.shift(); } chart.update('none'); }
        
        function initV2Game() {
            Object.assign(v2_dom, {
                canvasContainer: document.getElementById('v2-canvas-container'), cashDisplay: document.getElementById('v2-user-cash'), cubesDisplay: document.getElementById('v2-user-cubes'), prismsDisplay: document.getElementById('v2-user-prisms'), priceDisplay: document.getElementById('v2-current-price'), priceChangeDisplay: document.getElementById('v2-price-change'), prismPriceDisplay: document.getElementById('v2-current-prism-price'), prismPriceChangeDisplay: document.getElementById('v2-prism-price-change'), buyButtonCube: document.getElementById('v2-buy-button-cube'), sellButtonCube: document.getElementById('v2-sell-button-cube'), buyButtonPrism: document.getElementById('v2-buy-button-prism'), sellButtonPrism: document.getElementById('v2-sell-button-prism'), notification: document.getElementById('v2-notification'), buyCubeButton: document.getElementById('v2-buy-cube-button'), cubeOverlay: document.getElementById('v2-cube-purchase-overlay'), upgradePrismSection: document.getElementById('v2-upgrade-prism-section'), upgradePrismButton: document.getElementById('v2-upgrade-prism-button'), jobPaper: document.getElementById('v2-job-paper'), jobPaperTimer: document.getElementById('v2-job-paper-timer'), jobPaperText: document.getElementById('v2-job-paper-text'), codeSubmitButton: document.getElementById('v2-code-submit-button'), passiveIncomeDisplay: document.getElementById('v2-passive-income-display'), incomePerSecond: document.getElementById('v2-income-per-second'), chartTabCube: document.getElementById('v2-chart-tab-cube'), chartTabPrism: document.getElementById('v2-chart-tab-prism'), chartCubeContainer: document.getElementById('v2-chart-cube-container'), chartPrismContainer: document.getElementById('v2-chart-prism-container'), transactionHistory: document.getElementById('v2-transaction-history'), newsFeed: document.getElementById('v2-news-feed'), codeInput: document.getElementById('v2-code-input'), amountInputCube: document.getElementById('v2-amount-input-cube'), amountInputPrism: document.getElementById('v2-amount-input-prism'),
                userLunar: document.getElementById('v2-user-lunar'), currentLunarPrice: document.getElementById('v2-current-lunar-price'), lunarPriceChange: document.getElementById('v2-lunar-price-change'), lunarPriceDisplay: document.getElementById('v2-lunar-price-display'), lunarAssetDisplay: document.getElementById('v2-lunar-asset-display'), buyButtonLunar: document.getElementById('v2-buy-button-lunar'), sellButtonLunar: document.getElementById('v2-sell-button-lunar'), amountInputLunar: document.getElementById('v2-amount-input-lunar'), gameTime: document.getElementById('v2-game-time'), timeContainer: document.getElementById('v2-time-container'), jobStarcatching: document.getElementById('v2-job-starcatching'), jobStarcatchingTimer: document.getElementById('v2-job-starcatching-timer'), sleepButton: document.getElementById('v2-sleep-button'), sleepSection: document.getElementById('v2-sleep-section'), upgradeLunarSection: document.getElementById('v2-upgrade-lunar-section'), upgradeLunarBlessingButton: document.getElementById('v2-upgrade-lunar-blessing-button'), chartTabLunar: document.getElementById('v2-chart-tab-lunar'), chartLunarContainer: document.getElementById('v2-chart-lunar-container'), lunarTradeSection: document.getElementById('v2-lunar-trade-section'), gameTitle: document.getElementById('v2-game-title'), versionDisplay: document.getElementById('v2-version-display'), updateList: document.getElementById('v2-update-list'),
                trophyList: document.getElementById('v2-trophy-list'), trophyEffects: document.getElementById('v2-trophy-effects')
            });
            v2_dom.buyButtonCube.addEventListener('click', () => v2_handleTrade('buy', 'cube')); v2_dom.sellButtonCube.addEventListener('click', () => v2_handleTrade('sell', 'cube')); v2_dom.buyButtonPrism.addEventListener('click', () => v2_handleTrade('buy', 'prism')); v2_dom.sellButtonPrism.addEventListener('click', () => v2_handleTrade('sell', 'prism')); v2_dom.buyCubeButton.addEventListener('click', v2_handleBuy3DCube); v2_dom.upgradePrismButton.addEventListener('click', v2_handleUpgradePrism); v2_dom.jobPaper.addEventListener('click', v2_handleJobClick); v2_dom.codeSubmitButton.addEventListener('click', v2_handleCodeSubmit); document.getElementById('v2-logout-button').addEventListener('click', window.handleLogout); v2_dom.chartTabCube.addEventListener('click', () => v2_switchChart('cube')); v2_dom.chartTabPrism.addEventListener('click', () => v2_switchChart('prism')); ['assets', 'trade', 'charts', 'history', 'news', 'jobs', 'trophies', 'code', 'updates'].forEach(s => document.getElementById(`v2-toggle-${s}`)?.addEventListener('click', () => { document.getElementById(`v2-content-${s}`).classList.toggle('hidden'); document.getElementById(`v2-toggle-${s}-icon`).classList.toggle('rotate-180'); })); 
            
            if (isV3Active) {
                v2_activateV3Features(false); // Activate V3 UI, but don't re-init things if called from here
            }

            initV2Three();
            initV2Charts();
            if (v2_gameLoopTimeout) clearTimeout(v2_gameLoopTimeout);
            if (v2_priceUpdateTimeout) clearTimeout(v2_priceUpdateTimeout);
            v2_gameLoop(); 
            v2_priceUpdateLoop();
        }

        function v2_activateV3Features(isDynamic = true) {
            if(isDynamic) isV3Active = true;

            v2_dom.gameTitle.textContent = 'íë¸Œ ì½”ì¸ ì‹œë®¬ë ˆì´í„° v.0.3.0';
            v2_dom.versionDisplay.textContent = '(v.0.3.0)';
            v2_dom.updateList.innerHTML = '<li>v.0.3.0 ë‹¬ë¹› ì—…ë°ì´íŠ¸ ì ìš©</li><li>ë‚®ê³¼ ë°¤ ì‹œìŠ¤í…œ ì¶”ê°€</li><li>ì‹ ê·œ ì½”ì¸ $LUNAR ë° ë‹¬ë¹› ì´ë²¤íŠ¸ ì¶”ê°€</li><li>ìˆ˜ë©´ ì‹œìŠ¤í…œ ì¶”ê°€</li><li>\'íì§€ ì¤ê¸°\' ë¡œì§ ì•ˆì •í™”</li>';
            
            if(isDynamic) v2_gameTime = new Date(2025, 10, 15, 9, 0, 0);
            v2_dom.lunarPriceDisplay.classList.remove('hidden');
            v2_dom.lunarAssetDisplay.classList.remove('hidden');
            v2_dom.lunarTradeSection.classList.remove('hidden');
            v2_dom.chartTabLunar.classList.remove('hidden');
            v2_dom.timeContainer.classList.remove('hidden');
            v2_dom.sleepSection.classList.remove('hidden');
            if(v2_isCubePurchased) v2_dom.upgradeLunarSection.classList.remove('hidden');

            v2_dom.buyButtonLunar.addEventListener('click', () => v2_handleTrade('buy', 'lunar')); v2_dom.sellButtonLunar.addEventListener('click', () => v2_handleTrade('sell', 'lunar'));
            v2_dom.jobStarcatching.addEventListener('click', v2_handleJobClick);
            v2_dom.chartTabLunar.addEventListener('click', () => v2_switchChart('lunar'));
            v2_dom.upgradeLunarBlessingButton.addEventListener('click', v2_handleUpgradeLunarBlessing);
            v2_dom.sleepButton.addEventListener('click', v2_handleSleep);
            document.getElementById('v2-toggle-sleep')?.addEventListener('click', () => { document.getElementById(`v2-content-sleep`).classList.toggle('hidden'); document.getElementById(`v2-toggle-sleep-icon`).classList.toggle('rotate-180'); });
            
            initV2Charts(); // Re-init charts to add Lunar
            
            if(isDynamic) {
                if (v2_priceUpdateTimeout) clearTimeout(v2_priceUpdateTimeout);
                v2_priceUpdateLoop(); // Restart price loop with new logic
            }
        }

        function initV2Three() { v2_scene = new THREE.Scene(); v2_camera = new THREE.PerspectiveCamera(75, v2_dom.canvasContainer.clientWidth / v2_dom.canvasContainer.clientHeight, 0.1, 1000); v2_camera.position.z = 5; v2_renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); v2_renderer.setSize(v2_dom.canvasContainer.clientWidth, v2_dom.canvasContainer.clientHeight); v2_dom.canvasContainer.prepend(v2_renderer.domElement); const geometry = new THREE.BoxGeometry(2.5, 2.5, 2.5); v2_cubeMaterial = new THREE.MeshStandardMaterial({ color: 0x60a5fa, metalness: 0.5, roughness: 0.1, transparent: true, opacity: 0.9 }); v2_cube = new THREE.Mesh(geometry, v2_cubeMaterial); v2_scene.add(v2_cube); v2_ambientLight = new THREE.AmbientLight(0xffffff, 0.7); v2_scene.add(v2_ambientLight); v2_directionalLight = new THREE.DirectionalLight(0xffffff, 1); v2_directionalLight.position.set(5, 5, 5); v2_scene.add(v2_directionalLight); v2_animate(); }
        function v2_animate() { requestAnimationFrame(v2_animate); if (v2_isCubePurchased) { v2_cube.rotation.x += 0.005; v2_cube.rotation.y += 0.005; } if (v2_renderer) v2_renderer.render(v2_scene, v2_camera); }
        function v2_showNotification(message, isError = true) { v2_dom.notification.textContent = message; v2_dom.notification.className = `fixed bottom-6 right-6 text-white p-4 rounded-lg shadow-xl z-50 ${isError ? 'bg-red-500' : 'bg-green-500'} opacity-100 translate-y-0 transition-all duration-300`; setTimeout(() => { v2_dom.notification.classList.add('opacity-0', 'translate-y-10'); }, 3000); }
        
        function v2_updateTrophyDisplay() {
            if (!v2_dom.trophyList || !v2_dom.trophyEffects) return;

            v2_dom.trophyList.innerHTML = '';
            let totalEffectsHTML = '';
            let hasEffects = false;

            for (const key in TROPHIES) {
                const trophy = TROPHIES[key];
                const isUnlocked = trophy.isUnlocked();

                const trophyEl = document.createElement('div');
                trophyEl.className = `bg-gray-600 p-3 rounded-lg flex items-center gap-4 transition-opacity ${isUnlocked ? '' : 'opacity-50'}`;
                
                trophyEl.innerHTML = `
                    <div>
                        <span class="font-bold text-lg ${isUnlocked ? 'text-yellow-400' : 'text-gray-400'}">${isUnlocked ? 'ğŸ†' : 'ğŸ”’'} ${trophy.name}</span>
                        <p class="text-xs text-gray-400 mt-1">${trophy.description}</p>
                    </div>
                `;
                v2_dom.trophyList.appendChild(trophyEl);

                if (isUnlocked) {
                    totalEffectsHTML += `<p>â€¢ ${trophy.effectText}</p>`;
                    hasEffects = true;
                }
            }

            if (hasEffects) {
                v2_dom.trophyEffects.innerHTML = totalEffectsHTML;
            } else {
                v2_dom.trophyEffects.innerHTML = '<p class="text-gray-500">í™œì„±í™”ëœ íš¨ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        function v2_updateUI() {
            if (!v2_dom.cashDisplay) return;
            v2_dom.cashDisplay.textContent = Math.floor(v2_userCash).toLocaleString('ko-KR');
            v2_dom.cubesDisplay.textContent = v2_userCubes.toLocaleString('ko-KR', { maximumFractionDigits: 4 });
            v2_dom.prismsDisplay.textContent = v2_userPrisms.toLocaleString('ko-KR');
            
            const updatePriceDisplay = (display, changeDisplay, current, last) => {
                display.textContent = `${current.toLocaleString('ko-KR')} KRW`;
                const change = current - last;
                const pct = last > 0 ? ((change / last) * 100).toFixed(2) : 0;
                if (change > 0) changeDisplay.innerHTML = `<span class="text-green-500">â–² ${change.toLocaleString('ko-KR')} (+${pct}%)</span>`;
                else if (change < 0) changeDisplay.innerHTML = `<span class="text-red-500">â–¼ ${Math.abs(change).toLocaleString('ko-KR')} (${pct}%)</span>`;
                else changeDisplay.innerHTML = `0 (0.00%)`;
            };
            updatePriceDisplay(v2_dom.priceDisplay, v2_dom.priceChangeDisplay, v2_currentPrice, v2_lastPrice);
            updatePriceDisplay(v2_dom.prismPriceDisplay, v2_dom.prismPriceChangeDisplay, v2_currentPrismPrice, v2_lastPrismPrice);
            
            let lunarIncome = 0;
            if (isV3Active) {
                v2_dom.userLunar.textContent = v2_userLunar.toLocaleString('ko-KR');
                updatePriceDisplay(v2_dom.currentLunarPrice, v2_dom.lunarPriceChange, v2_currentLunarPrice, v2_lastLunarPrice);
                const gameHours = v2_gameTime.getHours();
                const gameMinutes = String(v2_gameTime.getMinutes()).padStart(2, '0');
                v2_dom.gameTime.textContent = `${String(gameHours).padStart(2, '0')}:${gameMinutes} (${v2_isDay ? 'Day' : 'Night'})`;
                if(v2_isLunarBlessed && !v2_isDay) lunarIncome = 100;
            }

            const baseIncome = v2_isCubePurchased ? 100 : 0;
            const prismIncome = v2_isPrismUpgraded ? 900 : 0;
            const totalIncome = baseIncome + prismIncome + lunarIncome;
            v2_dom.incomePerSecond.textContent = `+${totalIncome.toLocaleString('ko-KR')} KRW / sec`;
            
            v2_updateTransactionHistory();
            v2_updateTrophyDisplay();
        }

        function v2_updateTransactionHistory() { if (!v2_dom.transactionHistory) return; if (v2_transactions.length === 0) { v2_dom.transactionHistory.innerHTML = '<div class="text-gray-400 text-sm text-center p-4">...</div>'; return; } v2_dom.transactionHistory.innerHTML = ''; v2_transactions.slice(-100).forEach(tx => { const el = document.createElement('div'); el.className = 'border-b border-gray-600 p-2 text-sm'; const typeClass = tx.type === 'ë§¤ìˆ˜' ? 'text-green-400' : 'text-red-400'; el.innerHTML = `<div><span class="${typeClass} font-bold">[${tx.type}]</span> ${tx.amount.toLocaleString('ko-KR')} ${tx.coin}</div><div class="text-xs text-gray-400">@ ${tx.price.toLocaleString('ko-KR')} KRW</div>`; v2_dom.transactionHistory.prepend(el); }); }
        
        function v2_getNewPrice(currentPrice, config) {
            let trophyBonus = isV3Active && !v2_isDay && v2_hasTwilightTrophy ? 0.025 : 0;
            let dir = Math.random() < (config.riseProb + trophyBonus) ? 1 : -1;
            let mag = Math.random();
            let pct;
            if (mag < config.mags[0]) pct = (Math.random() * 0.02) + 0.001;
            else if (mag < config.mags[0] + config.mags[1]) pct = (Math.random() * 0.05) + 0.021;
            else pct = (Math.random() * 0.12) + 0.051;
            return Math.round(Math.max(config.min, currentPrice + (currentPrice * pct * dir)));
        }

        function v2_priceUpdateLoop(isSleeping = false) {
            const getFullConfig = (coinConfig, mode) => ({ min: coinConfig.min, ...coinConfig[mode] });
            const configs = {
                cube: { min: 1000, day: { riseProb: 0.51, mags: [0.5, 0.45, 0.05] }, night: { riseProb: 0.51, mags: [0.6, 0.4, 0] } },
                prism: { min: 5000, day: { riseProb: 0.53, mags: [0.5, 0.45, 0.05] }, night: { riseProb: 0.53, mags: [0.6, 0.4, 0] } },
                lunar: { min: 20000, day: { riseProb: 0.45, mags: [0.5, 0.45, 0.05] }, night: { riseProb: 0.55, mags: [0.4, 0.5, 0.1] } },
                sleep: { riseProb: 0.5, mags: [0.1, 0.4, 0.5] }
            };

            const updatePrices = (mode) => {
                v2_lastPrice = v2_currentPrice;
                v2_currentPrice = v2_getNewPrice(v2_currentPrice, mode === 'sleep' ? {min: configs.cube.min, ...configs.sleep} : getFullConfig(configs.cube, mode));
                if(!isSleeping) v2_updateChartData(v2_priceChart, v2_currentPrice);

                v2_lastPrismPrice = v2_currentPrismPrice;
                v2_currentPrismPrice = v2_getNewPrice(v2_currentPrismPrice, mode === 'sleep' ? {min: configs.prism.min, ...configs.sleep} : getFullConfig(configs.prism, mode));
                if(!isSleeping) v2_updateChartData(v2_prismPriceChart, v2_currentPrismPrice);
                
                if(isV3Active) {
                    v2_lastLunarPrice = v2_currentLunarPrice;
                    v2_currentLunarPrice = v2_getNewPrice(v2_currentLunarPrice, mode === 'sleep' ? {min: configs.lunar.min, ...configs.sleep} : getFullConfig(configs.lunar, mode));
                    if(!isSleeping) v2_updateChartData(v2_lunarPriceChart, v2_currentLunarPrice);
                }
            };
            
            if (!isV3Active) { // v0.2.2 logic
                 v2_lastPrice = v2_currentPrice; v2_currentPrice = v2_getNewPrice(v2_currentPrice, {riseProb: 0.51, mags: [0.7, 0.25, 0.05], min:1000}); v2_updateChartData(v2_priceChart, v2_currentPrice);
                 v2_lastPrismPrice = v2_currentPrismPrice; v2_currentPrismPrice = v2_getNewPrice(v2_currentPrismPrice, {riseProb: 0.53, mags: [0.6, 0.3, 0.1], min:5000}); v2_updateChartData(v2_prismPriceChart, v2_currentPrismPrice);
            } else {
                 updatePrices(isSleeping ? 'sleep' : (v2_isDay ? 'day' : 'night'));
            }

            if (!isSleeping) {
                const interval = isV3Active ? (v2_isDay ? 2000 : 4000) : 2000;
                v2_priceUpdateTimeout = setTimeout(v2_priceUpdateLoop, interval);
            }
        }
        
        function v2_gameLoop() {
            const now = Date.now();
            const isZeroCooldown = v2_zeroCooldownEndTime > now;

            if (isV3Active) {
                v2_gameTime.setMinutes(v2_gameTime.getMinutes() + 1); // 1 min per 250ms
                const currentHour = v2_gameTime.getHours();
                const wasDay = v2_isDay;
                v2_isDay = currentHour >= 9 && currentHour < 19;
                if (wasDay !== v2_isDay) { // Day/Night transition
                    const color = v2_isDay ? 0x222222 : 0x050522;
                    if(v2_renderer) v2_renderer.setClearColor(color);
                    if(v2_ambientLight) v2_ambientLight.intensity = v2_isDay ? 0.7 : 0.2;
                    if(v2_directionalLight) v2_directionalLight.intensity = v2_isDay ? 1.0 : 0.3;
                }
                
                v2_dom.jobStarcatching.classList.toggle('hidden', v2_isDay || v2_hasTwilightTrophy);
                const canSleep = currentHour >= 20 || currentHour < 8;
                v2_dom.sleepButton.classList.toggle('btn-disabled', !canSleep);
                
                if (v2_dom.jobPaperText) {
                    if(v2_hasTwilightTrophy && !v2_isDay) {
                        v2_dom.jobPaperText.textContent = 'ë‹¬ë¹› ì•„ë˜ íì§€ ì¤ê¸° (+1500)';
                    } else {
                        v2_dom.jobPaperText.textContent = 'íì§€ ì¤ê¸° (+500)';
                    }
                }
            }
            
            // KRW Passive Income
            const baseIncome = v2_isCubePurchased ? 100 : 0;
            const prismIncome = v2_isPrismUpgraded ? 900 : 0;
            let lunarIncome = 0;
            if (isV3Active && v2_isLunarBlessed && !v2_isDay) {
                lunarIncome = 100;
            }
            v2_userCash += (baseIncome + prismIncome + lunarIncome) / 4;

            // Job Timers
            Object.keys(v2_jobTimers).forEach(job => {
                const timerEl = v2_dom[`job${job}Timer`];
                const jobEl = v2_dom[`job${job}`];
                if (isZeroCooldown) {
                    if (jobEl) jobEl.classList.remove('btn-disabled');
                    if (timerEl) timerEl.textContent = '(0ì´ˆ)';
                } else {
                    if (v2_jobTimers[job] > now) {
                        const timeLeft = Math.ceil((v2_jobTimers[job] - now) / 1000);
                        if (timerEl) timerEl.textContent = `(${timeLeft}ì´ˆ)`;
                        if(jobEl) jobEl.classList.add('btn-disabled');
                    } else if(jobEl) {
                        jobEl.classList.remove('btn-disabled');
                        if (timerEl) timerEl.textContent = '';
                    }
                }
            });
            v2_updateUI();
            v2_gameLoopTimeout = setTimeout(v2_gameLoop, 250);
        }
        function v2_handleTrade(type, coin) {
            const amountInput = v2_dom[`amountInput${coin.charAt(0).toUpperCase() + coin.slice(1)}`];
            if (!amountInput) return;
            const amount = parseInt(amountInput.value);
            if (!(amount > 0)) return;
            const prices = { cube: v2_currentPrice, prism: v2_currentPrismPrice, lunar: v2_currentLunarPrice };
            const cost = prices[coin] * amount;
            const coinUpper = coin.toUpperCase();

            if (type === 'buy') {
                if (v2_userCash >= cost) {
                    v2_userCash -= cost;
                    if(coin === 'cube') v2_userCubes += amount; else if (coin === 'prism') v2_userPrisms += amount; else v2_userLunar += amount;
                    v2_transactions.push({ type: 'ë§¤ìˆ˜', coin: coinUpper, amount, price: prices[coin] });
                    v2_showNotification(`${amount} ${coinUpper} ë§¤ìˆ˜!`, false);
                } else { v2_showNotification('í˜„ê¸ˆ ë¶€ì¡±', true); return; }
            } else { // sell
                if ((coin === 'cube' && v2_userCubes >= amount) || (coin === 'prism' && v2_userPrisms >= amount) || (coin === 'lunar' && v2_userLunar >= amount)) {
                    v2_userCash += cost;
                    if(coin === 'cube') v2_userCubes -= amount; else if (coin === 'prism') v2_userPrisms -= amount; else v2_userLunar -= amount;
                    v2_transactions.push({ type: 'ë§¤ë„', coin: coinUpper, amount, price: prices[coin] });
                    v2_showNotification(`${amount} ${coinUpper} ë§¤ë„!`, false);
                } else { v2_showNotification(`${coinUpper} ë¶€ì¡±`, true); return; }
            }
            v2_updateUI(); v2_saveGameState().catch(e => console.error("Save failed:", e));
        }

        function v2_handleCodeSubmit() {
            const code = v2_dom.codeInput.value.trim();
            if (code === '') return;
        
            // Developer Codes (reusable)
            if (code === 'ice_cube101') {
                v2_zeroCooldownEndTime = Date.now() + 60 * 1000;
                v2_showNotification('ê°œë°œì ì½”ë“œ: 1ë¶„ê°„ ì‘ì—… ì¿¨íƒ€ì„ì´ ì œê±°ë©ë‹ˆë‹¤!', false);
                v2_dom.codeInput.value = '';
                v2_updateUI(); // To immediately reflect cooldown change
                return; // No need to save, it's a temporary client-side buff
            }
            if (code === 'ice_cube102') {
                v2_userCash += 1000000000000;
                v2_showNotification('ê°œë°œì ì½”ë“œ: 1ì¡° KRW!', false);
                v2_dom.codeInput.value = '';
                v2_updateUI();
                v2_saveGameState().catch(e => console.error("Save failed:", e));
                return;
            }
            if (code === 'ice_cube103') {
                v2_starCatchingBuffEndTime = Date.now() + 60 * 1000;
                v2_showNotification('ê°œë°œì ì½”ë“œ: 1ë¶„ê°„ ë°¤í•˜ëŠ˜ì˜ ë³„ ë”°ê¸° í™•ë¥ ì´ 10%ë¡œ ì¦ê°€í•©ë‹ˆë‹¤!', false);
                v2_dom.codeInput.value = '';
                return;
            }

            // New day/night developer codes for v.0.3.0+
            if (isV3Active) {
                if (code === 'ice_day') {
                    v2_gameTime.setHours(9, 0, 0);
                    v2_showNotification('ê°œë°œì ì½”ë“œ: ì‹œê°„ì„ ë‚®ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.', false);
                    v2_dom.codeInput.value = '';

                    // Manually trigger day transition logic for instant visual feedback
                    v2_isDay = true;
                    if(v2_renderer) v2_renderer.setClearColor(0x222222);
                    if(v2_ambientLight) v2_ambientLight.intensity = 0.7;
                    if(v2_directionalLight) v2_directionalLight.intensity = 1.0;
                    
                    v2_updateUI(); // Update text displays like clock and button states
                    return; // Don't save, it's a dev tool
                }
                if (code === 'ice_night') {
                    v2_gameTime.setHours(20, 0, 0);
                    v2_showNotification('ê°œë°œì ì½”ë“œ: ì‹œê°„ì„ ë°¤ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.', false);
                    v2_dom.codeInput.value = '';

                    // Manually trigger night transition logic for instant visual feedback
                    v2_isDay = false;
                    if(v2_renderer) v2_renderer.setClearColor(0x050522);
                    if(v2_ambientLight) v2_ambientLight.intensity = 0.2;
                    if(v2_directionalLight) v2_directionalLight.intensity = 0.3;

                    v2_updateUI(); // Update text displays like clock and button states
                    return; // Don't save, it's a dev tool
                }
            }
        
            // Check if code was already used
            if (v2_usedCodes.includes(code)) {
                v2_showNotification('ì´ë¯¸ ì‚¬ìš©ëœ ì½”ë“œ', true);
                return;
            }
        
            const lunarUpdate = UPDATES.find(u => u.code === 'LUNAR');
            if (lunarUpdate && code === 'LUNAR') {
                const now = Date.now();
                const codeWindow = lunarUpdate.codeWindowHours * 60 * 60 * 1000;
                const isCodeActive = now >= (lunarUpdate.time - codeWindow) && now <= (lunarUpdate.time + codeWindow);
                
                if (!isCodeActive) {
                    v2_showNotification('ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ ì½”ë“œ', true);
                    return;
                }
                v2_userCash += 50000;
                if(isV3Active) v2_userLunar += 1;
                v2_showNotification('ì—…ë°ì´íŠ¸ ê¸°ë… ë³´ìƒ! (+50,000 KRW, +1 LUNAR)', false);
                v2_usedCodes.push(code);

            } else if (code === 'v.0.3.0') {
                if (!isV3Active) {
                    isPreviewMode = true;
                    v2_showNotification('v.0.3.0 ë¯¸ë¦¬ ì²´í—˜ ëª¨ë“œë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤! (ì§„í–‰ë‚´ìš© ì €ì¥ ì•ˆë¨)', false);
                    v2_activateV3Features(true);
                    return; // Special case, doesn't save game state
                } else {
                    v2_userLunar += 10;
                    v2_showNotification('v.0.3.0 ì—…ë°ì´íŠ¸ ë³´ìƒ: 10 LUNAR!', false);
                    v2_usedCodes.push(code);
                }
            } else if (code === 'PRISM') {
                v2_userCash += 200000;
                v2_showNotification("v2 ì—…ë°ì´íŠ¸ ë³´ìƒ: 200,000 KRW!", false);
                v2_usedCodes.push(code);
            } else {
                v2_showNotification('ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œ', true);
                return;
            }
            
            v2_dom.codeInput.value = '';
            v2_updateUI();
            v2_saveGameState().catch(e => console.error("Save failed:", e));
        }

        function v2_handleJobClick(e) {
            const id = e.currentTarget.id.split('-')[2];
            const now = Date.now();
            const isZeroCooldown = v2_zeroCooldownEndTime > now;

            if (!isZeroCooldown && v2_jobTimers[id] > now) { 
                v2_showNotification('ì•„ì§ ì¿¨íƒ€ì„ì…ë‹ˆë‹¤.', true); 
                return; 
            }

            if (id === 'paper') { 
                const isEnhanced = isV3Active && v2_hasTwilightTrophy && !v2_isDay;
                const reward = isEnhanced ? 1500 : 500;
                const message = isEnhanced ? 'ë‹¬ë¹›ì„ ë°›ìœ¼ë©° íì§€ ì¤ê¸° ì™„ë£Œ! (+1500 KRW)' : 'íì§€ ì¤ê¸° ì™„ë£Œ! (+500 KRW)';
                v2_userCash += reward; 
                v2_paperClicks++; 
                v2_showNotification(message, false); 
                if (!isZeroCooldown) v2_jobTimers.paper = now + 5000; 
            }
            
            if (isV3Active && id === 'starcatching') {
                if (v2_hasTwilightTrophy) {
                    v2_showNotification('ì´ë¯¸ ë°¤í•˜ëŠ˜ì˜ ë³„ì„ ì†ì— ë„£ì—ˆìŠµë‹ˆë‹¤.', true);
                    return;
                }
                const isBuffActive = v2_starCatchingBuffEndTime > now;
                const probability = isBuffActive ? 0.10 : 0.01;
                
                if(Math.random() < probability) { 
                    v2_hasTwilightTrophy = true; 
                    v2_showNotification(`ë³„ì„ ë•„ìŠµë‹ˆë‹¤! [Twilight Trophy] íšë“! (ì„±ê³µ í™•ë¥ : ${probability * 100}%)`, false); 
                    v2_dom.jobStarcatching.classList.add('hidden');
                } else { 
                    v2_showNotification('ë³„ì„ ë†“ì³¤ìŠµë‹ˆë‹¤...', true); 
                }
                if (!isZeroCooldown) v2_jobTimers.starcatching = now + 5000;
            }
            v2_updateUI(); v2_saveGameState().catch(e => console.error("Save failed:", e));
        }
        function v2_handleBuy3DCube() { if (v2_userCash >= 1000000) { v2_userCash -= 1000000; v2_isCubePurchased = true; v2_dom.cubeOverlay.style.display = 'none'; v2_dom.passiveIncomeDisplay.classList.remove('hidden'); v2_dom.upgradePrismSection.classList.remove('hidden'); if(isV3Active) v2_dom.upgradeLunarSection.classList.remove('hidden'); v2_updateUI(); v2_showNotification('3D íë¸Œ í™œì„±í™”! íŒ¨ì‹œë¸Œ ìˆ˜ì… ì‹œì‘!', false); v2_saveGameState().catch(e => console.error("Save failed:", e)); } else v2_showNotification('1ë°±ë§Œ KRW í•„ìš”', true); }
        function v2_handleUpgradePrism() { if (!v2_isPrismUpgraded && v2_userPrisms >= 100) { v2_userPrisms -= 100; v2_isPrismUpgraded = true; v2_dom.upgradePrismSection.style.display = 'none'; v2_cubeMaterial.color.set(0xf472b6); v2_cubeMaterial.emissive.set(0xf472b6); v2_cubeMaterial.emissiveIntensity = 0.3; v2_updateUI(); v2_showNotification('í”„ë¦¬ì¦˜ ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!', false); v2_saveGameState().catch(e => console.error("Save failed:", e)); } else v2_showNotification('100 PRISM í•„ìš”', true); }
        function v2_handleUpgradeLunarBlessing() { if (v2_isLunarBlessed) { v2_showNotification('ì´ë¯¸ ì ìš©ëœ ê°•í™”ì…ë‹ˆë‹¤.', true); return; } if (v2_userLunar >= 200) { v2_userLunar -= 200; v2_isLunarBlessed = true; v2_dom.upgradeLunarBlessingButton.classList.add('btn-disabled'); v2_showNotification('Lunar Blessing ì™„ë£Œ!', false); v2_updateUI(); v2_saveGameState().catch(e => console.error("Save failed:", e)); } else { v2_showNotification('200 LUNAR í•„ìš”', true); } }
        
        function v2_handleSleep() {
            const currentHour = v2_gameTime.getHours();
            if (currentHour < 20 && currentHour >= 8) { v2_showNotification('ë°¤ì—ë§Œ ì˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', true); return; }
            let hoursToSleep = (currentHour < 8) ? (8 - currentHour) : (24 - currentHour + 8);
            for(let i = 0; i < hoursToSleep * 60; i++) {
                v2_priceUpdateLoop(true); // isSleeping = true
            }
            v2_gameTime.setHours(8, 0, 0);
            if (currentHour >= 20) v2_gameTime.setDate(v2_gameTime.getDate() + 1);
            v2_isDay = true;
            v2_showNotification(`${hoursToSleep}ì‹œê°„ ë™ì•ˆ ìˆ˜ë©´í–ˆìŠµë‹ˆë‹¤.`, false);
            v2_updateUI();
            v2_saveGameState().catch(e => console.error("Save failed:", e));
        }
        function v2_switchChart(chartType) {
            ['cube', 'prism', 'lunar'].forEach(type => {
                const tab = document.getElementById(`v2-chart-tab-${type}`);
                const container = document.getElementById(`v2-chart-${type}-container`);
                if(tab) tab.classList.toggle('tab-active', type === chartType);
                if(container) container.classList.toggle('hidden', type !== chartType);
            });
        }
        
        function v2_saveGameState() {
            if (isPreviewMode) {
                console.log("Save skipped: Preview mode is active.");
                return Promise.resolve();
            }
            if (!db || !userId) {
                console.warn("Save skipped: no db or userId");
                return Promise.resolve();
            }
            const gameState = {
                userCash: v2_userCash, userCubes: v2_userCubes, userPrisms: v2_userPrisms, transactions: v2_transactions, isCubePurchased: v2_isCubePurchased, isPrismUpgraded: v2_isPrismUpgraded, usedCodes: v2_usedCodes, paperClicks: v2_paperClicks,
                userLunar: v2_userLunar, hasTwilightTrophy: v2_hasTwilightTrophy, isLunarBlessed: v2_isLunarBlessed, gameTime: isV3Active ? v2_gameTime.getTime() : null
            };
            if (window.setDoc) {
                console.log("Attempting to save game state for user:", userId);
                const docRef = window.doc(db, "users", userId, "simulator_state", "game_data_v2");
                return window.setDoc(docRef, gameState);
            } else {
                 console.warn("Save skipped: setDoc not available");
                 return Promise.resolve();
            }
        }

        function v2_loadGameState(docSnap) {
            if (docSnap.exists()) {
                console.log("Loading saved game state for user:", userId);
                const data = docSnap.data();
                v2_userCash = data.userCash ?? 100000; v2_userCubes = data.userCubes ?? 0; v2_userPrisms = data.userPrisms ?? 0; v2_transactions = data.transactions ?? []; v2_isCubePurchased = data.isCubePurchased ?? false; v2_isPrismUpgraded = data.isPrismUpgraded ?? false; v2_usedCodes = data.usedCodes ?? []; v2_paperClicks = data.paperClicks ?? 0;
                if (isV3Active) {
                    v2_userLunar = data.userLunar ?? 0; v2_hasTwilightTrophy = data.hasTwilightTrophy ?? false; v2_isLunarBlessed = data.isLunarBlessed ?? false; v2_gameTime = data.gameTime ? new Date(data.gameTime) : new Date(2025, 10, 15, 9, 0, 0);
                }
            } else {
                console.log("No saved data found, initializing new game state for user:", userId);
                if (isV3Active) v2_gameTime = new Date(2025, 10, 15, 9, 0, 0);
                v2_saveGameState().catch(e => console.error("Error saving initial game state:", e));
            }
            v2_updateUI();
            if (v2_isCubePurchased) { v2_dom.cubeOverlay.style.display = 'none'; v2_dom.passiveIncomeDisplay.classList.remove('hidden'); v2_dom.upgradePrismSection.classList.remove('hidden'); if(isV3Active) v2_dom.upgradeLunarSection.classList.remove('hidden'); }
            if (v2_isPrismUpgraded) { v2_dom.upgradePrismSection.style.display = 'none'; v2_cubeMaterial.color.set(0xf472b6); v2_cubeMaterial.emissive.set(0xf472b6); v2_cubeMaterial.emissiveIntensity = 0.3; }
            if (isV3Active && v2_isLunarBlessed) { v2_dom.upgradeLunarBlessingButton.classList.add('btn-disabled'); }
            v2_updateTrophyDisplay();
        }

        async function loadGameData() {
            if (!userId) return;
            const docRef = window.doc(db, "users", userId, "simulator_state", "game_data_v2");
            const docSnap = await window.getDoc(docRef);
            v2_loadGameState(docSnap);
        }

        function initFirebaseAndAuth() {
            import("https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js").then(({ initializeApp }) =>
            import("https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js").then(({ getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, setPersistence, inMemoryPersistence }) =>
            import("https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js").then(({ getFirestore, doc, getDoc, setDoc }) => {
                
                window.doc = doc; window.getDoc = getDoc; window.setDoc = setDoc;
                
                const firebaseConfig = {
                    apiKey: "AIzaSyAMkZ-JoMxZEc2mXbIlZfhf_bVr-wLSHjo",
                    authDomain: "cube-coin-simulator.firebaseapp.com",
                    projectId: "cube-coin-simulator",
                    storageBucket: "cube-coin-simulator.appspot.com",
                    messagingSenderId: "734525632764",
                    appId: "1:734525632764:web:ba9263fefeeca5726b6779",
                    measurementId: "G-LD98Y6BZ3H"
                };

                const loginContainer = document.getElementById('login-container');
                const v2Container = document.getElementById('v2-container');
                const loginErrorMessage = document.getElementById('login-error-message');

                try {
                    const app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    setPersistence(auth, inMemoryPersistence);

                    const handleAuthError = (error) => {
                        switch(error.code) {
                            case 'auth/user-not-found': case 'auth/wrong-password': loginErrorMessage.textContent = 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'; break;
                            case 'auth/email-already-in-use': loginErrorMessage.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.'; break;
                            case 'auth/weak-password': loginErrorMessage.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; break;
                            case 'auth/invalid-email': loginErrorMessage.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.'; break;
                            default: loginErrorMessage.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                        }
                    };

                    document.getElementById('login-button').addEventListener('click', async () => { const e = document.getElementById('login-email').value, p = document.getElementById('login-password').value; if (!e || !p) return; try { loginErrorMessage.textContent = ''; await signInWithEmailAndPassword(auth, e, p); } catch (e) { handleAuthError(e); } });
                    document.getElementById('signup-button').addEventListener('click', async () => { const e = document.getElementById('signup-email').value, p = document.getElementById('signup-password').value, c = document.getElementById('signup-password-confirm').value; if (!e || !p) return; if (p !== c) { loginErrorMessage.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'; return; } try { loginErrorMessage.textContent = ''; await createUserWithEmailAndPassword(auth, e, p); } catch (e) { handleAuthError(e); } });
                    
                    window.handleLogout = async () => {
                        if (userId && !v2Container.classList.contains('hidden')) {
                           try {
                                await v2_saveGameState();
                                console.log("Game state saved successfully before logout.");
                           } catch (error) {
                                console.error("Failed to save game state before logout:", error);
                           }
                        }
                        await signOut(auth);
                    };
                    
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            userId = user.uid;
                            loginContainer.classList.add('hidden');
                            v2Container.classList.remove('hidden');
                            initV2Game();
                            loadGameData();
                        } else {
                            userId = null;
                            if(v2_gameLoopTimeout) clearTimeout(v2_gameLoopTimeout);
                            if(v2_priceUpdateTimeout) clearTimeout(v2_priceUpdateTimeout);
                            v2Container.classList.add('hidden');
                            loginContainer.classList.remove('hidden');
                        }
                    });
                } catch (e) { alert("Firebase ì´ˆê¸°í™” ì‹¤íŒ¨!"); }
            })));
        }

        window.onload = () => {
            const v3update = UPDATES.find(u => u.version === 'v.0.3.0');
            isV3Active = v3update ? (Date.now() >= v3update.time) : false;
            
            const banner = document.getElementById('update-banner');
            const now = Date.now();
            const nextUpdate = UPDATES.find(update => update.time > now);
        
            if (nextUpdate) {
                const fiveHours = 5 * 60 * 60 * 1000;
                const codeWindow = (nextUpdate.codeWindowHours || 1) * 60 * 60 * 1000;
        
                if (now >= (nextUpdate.time - fiveHours) && now <= (nextUpdate.time + codeWindow)) {
                    banner.classList.remove('hidden');
                    let interval;
                    const countdown = () => {
                        const currentTime = Date.now();
                        const timeLeft = nextUpdate.time - currentTime;
                        
                        let bannerText = '';
        
                        if (timeLeft > 0) {
                            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                            bannerText = `${nextUpdate.version} ì—…ë°ì´íŠ¸ê¹Œì§€: ${hours}ì‹œê°„ ${minutes}ë¶„ ${seconds}ì´ˆ`;
                        } else {
                            bannerText = `${nextUpdate.version} ì—…ë°ì´íŠ¸ ì ìš©! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.`;
                        }
                        
                        if (nextUpdate.code && currentTime >= (nextUpdate.time - codeWindow) && currentTime <= (nextUpdate.time + codeWindow)) {
                             bannerText += ` <span class="mx-2 font-extrabold text-yellow-300 animate-pulse">[ì½”ë“œ: ${nextUpdate.code}]</span> ì…ë ¥ ì‹œ íŠ¹ë³„ ë³´ìƒ ì§€ê¸‰!`;
                        }
                        
                        banner.innerHTML = bannerText;
        
                        if (currentTime > nextUpdate.time + codeWindow) {
                            banner.classList.add('hidden');
                            if (interval) clearInterval(interval);
                        }
                    };
                    interval = setInterval(countdown, 1000);
                    countdown();
                }
            }

            const loginForm = document.getElementById('login-form'), signupForm = document.getElementById('signup-form');
            document.getElementById('show-signup-form').addEventListener('click', (e) => { e.preventDefault(); loginForm.classList.add('hidden'); signupForm.classList.remove('hidden'); });
            document.getElementById('show-login-form').addEventListener('click', (e) => { e.preventDefault(); signupForm.classList.add('hidden'); loginForm.classList.remove('hidden'); });
            
            initFirebaseAndAuth();
        };
    </script>
</body>
</html>
